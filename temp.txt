









// PolylinesList.jsx

import React, { useEffect, useState } from "react";
import PolylineChart from "./PolylineChart"; // Import the PolylineChart component

const PolylinesList = ({ enrolledPolylines, topicData }) => {
    const [localPolylines, setLocalPolylines] = useState([]);

    console.log("currentCourseId:", localStorage.getItem("currentCourseId"));
    console.log("topicData:", topicData);

    // Get the polylines from localStorage **once** at the start
    const enrolledPolylinesFromLS = JSON.parse(localStorage.getItem("enrolledPolylines")) || [];
    console.log("currentLearner's polyline from LS:", enrolledPolylinesFromLS);

    useEffect(() => {
        if (Array.isArray(enrolledPolylinesFromLS)) {
            setLocalPolylines(enrolledPolylinesFromLS);
        } else {
            console.error("enrolledPolylinesFromLS is not an array:", enrolledPolylinesFromLS);
            setLocalPolylines([]);
        }

        // Remove from localStorage after setting local state
        return () => {
            console.log("Removing enrolledPolylines from localStorage...");
            localStorage.removeItem("enrolledPolylines");
        };
    }, []); // Runs only once when the component mounts

    // Prefer localPolylines over enrolledPolylines
    const polylinesToRender = Array.isArray(localPolylines) && localPolylines.length > 0
        ? localPolylines
        : (Array.isArray(enrolledPolylines) ? enrolledPolylines : []);

    console.log("polylinesToRender is", polylinesToRender);
    console.log("Is polylinesToRender an array?", Array.isArray(polylinesToRender));
    console.log("Type of polylinesToRender is", typeof polylinesToRender);
    console.log("polylinesToRender.length is", polylinesToRender.length);

    return (
        <div className="polylines-container" style={{ padding: "20px", backgroundColor: "#f5f5f5" }}>
            <h1 style={{ textAlign: "center", marginBottom: "20px" }}>My Learning Journey</h1>
            {polylinesToRender.length > 0 ? (
                polylinesToRender.map((polyline, index) => (
                    <div
                        key={index}
                        className="polyline-item"
                        style={{
                            marginBottom: "40px",
                            padding: "20px",
                            backgroundColor: "white",
                            borderRadius: "10px",
                            boxShadow: "0 2px 10px rgba(0, 0, 0, 0.1)",
                        }}
                    >
                        <h2 style={{ textAlign: "center", marginBottom: "20px" }}>
                            {index === 0 ? "Initial Polyline" : `After ${index} Contribution`}
                        </h2>
                        {/* Ensure polyline is an array before passing it to the chart */}
                        <PolylineChart polyline={Array.isArray(polyline) ? polyline : []} topicData={topicData} />
                    </div>
                ))
            ) : (
                <p style={{ textAlign: "center", fontSize: "18px", color: "#555" }}>
                    No enrolled polylines found.
                </p>
            )}
        </div>
    );
};

export default PolylinesList;


// PolylineChart.jsx
import React, { useEffect, useState } from "react";

const PolylineChart = ({ polyline, topicData }) => {
    console.log("Original polyline data:", polyline);

    console.log("Topic data:", topicData);

    // Get polyline from `currentLearner` if it is undefined
    // if (polyline==undefined || polyline?.[0]?.length === 0) {
    if (!polyline || polyline.length === 0 || polyline[0].length === 0) {
        const currLearner = JSON.parse(localStorage.getItem("currentLearner"));
        console.log("currentLearner: ", currLearner);
        console.log("currLearner.polyline: ", currLearner?.polyline);
        polyline = currLearner?.polyline || [];
    }
    console.log("Setting the polyline: ", JSON.parse(localStorage.getItem("currentLearner"))?.polyline);

    // Ensure `polyline` is a flat array of numbers
    const flattenedPolyline = Array.isArray(polyline) ? polyline.flat() : [];

    const [tooltip, setTooltip] = useState({ display: false, x: 0, y: 0, value: 0 });

    const svgWidth = 500;
    const svgHeight = 300;
    const padding = 60;
    const yAxisLabels = [1, 0.75, 0.5, 0.25, 0];

    // Convert data points to SVG coordinates
    const points = flattenedPolyline.map((value, index) => {
        const x = padding + (index / (flattenedPolyline.length - 1)) * (svgWidth - 2 * padding);
        const y = svgHeight - padding - value * (svgHeight - 2 * padding);
        return { x, y, value, index };
    });

    const handleMouseEnter = (event, value) => {
        setTooltip({ display: true, x: event.clientX, y: event.clientY, value });
    };

    const handleMouseLeave = () => {
        setTooltip({ ...tooltip, display: false });
    };

    return (
        <div>
            <svg width={svgWidth} height={svgHeight} style={{ border: "1px solid black" }}>
                {/* Axes */}
                <line x1={padding} y1={padding} x2={padding} y2={svgHeight - padding} stroke="black" />
                <line x1={padding} y1={svgHeight - padding} x2={svgWidth - padding} y2={svgHeight - padding} stroke="black" />

                {/* Y-Axis Labels and Grid Lines */}
                {yAxisLabels.map((label, index) => {
                    const y = svgHeight - padding - label * (svgHeight - 2 * padding);
                    return (
                        <g key={index}>
                            <text x={padding - 10} y={y} textAnchor="end" dominantBaseline="middle">{label}</text>
                            <line x1={padding} x2={svgWidth - padding} y1={y} y2={y} stroke="lightgray" strokeDasharray="5, 5" />
                        </g>
                    );
                })}

                {/* X-Axis Labels and Grid Lines */}
                {points.map(({ x, index }) => (
                    <g key={index}>
                        <text x={x} y={svgHeight - padding + 20} textAnchor="middle">{index + 1}</text>
                        <line x1={x} x2={x} y1={padding} y2={svgHeight - padding} stroke="lightgray" strokeDasharray="5, 5" />
                    </g>
                ))}

                {/* Y-Axis Title */}
                <text x={padding - 50} y={svgHeight / 2} textAnchor="middle" dominantBaseline="middle" transform={`rotate(-90, ${padding - 50}, ${svgHeight / 2})`}>
                    Assimilation
                </text>

                {/* X-Axis Title */}
                <text x={svgWidth / 2} y={svgHeight - padding + 40} textAnchor="middle">Topic Index</text>

                {/* Step Polyline */}
                <polyline
                    points={points.map(({ x, y }) => `${x},${y}`).join(" ")}
                    style={{ fill: "none", stroke: "blue", strokeWidth: 2 }}
                />

                {/* Circles on points for tooltips */}
                {points.map(({ x, y, value, index }) => (
                    <circle
                        key={index}
                        cx={x}
                        cy={y}
                        r={4}
                        fill="blue"
                        stroke="blue"
                        strokeWidth={2}
                        onMouseEnter={(e) => handleMouseEnter(e, value)}
                        onMouseLeave={handleMouseLeave}
                        title={`Assimilation: ${value.toFixed(3)}\nTopic: ${topicData[index]?.name || "Unknown"}`} // Simple Tooltip
                    />
                ))}
            </svg>

            {/* Custom Tooltip */}
            {tooltip.display && (
                <div
                    style={{
                        position: "absolute",
                        left: tooltip.x + 10,
                        top: tooltip.y + 10,
                        background: "white",
                        padding: "5px",
                        border: "1px solid black",
                        borderRadius: "5px",
                        fontSize: "12px",
                        pointerEvents: "none",
                    }}
                >
                    <strong>Assimilation:</strong> {tooltip.value.toFixed(3)}
                </div>
            )}
        </div>
    );
};

export default PolylineChart;


I WANT TO SEE BETTER REPRESENTAION OF POLYLINES AS AFTER EACH CONTRIBUTION THE CONSECUTIVE LINES DO NOT CHANGE MUCH. SO I WAS TOLD TO ZOOM IN DYNAMICALLY. I DON'T KNOW. DO IT GOOD OKAY